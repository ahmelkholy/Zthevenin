clear all;clc;close all;disp('IEE 33bus system')
basemva = 100;  accuracy = 0.00001;  maxiter = 1000
% The impedances are expressed on a 1000 MVA base.
% In problems 9.7-9.9 the base is mistakenly stated as 100 MVA. 
%       Bus  Bus   |V|  Ang   ---Load---      ---Gen---   Gen Mvar Injected
%       No.  code p.u.  Deg   MW     Mvar   MW   Mvar   Min   Max    Mvar
busdata=[ 1   1    1     0    0       0      0   0   0   0   0
          2   0    1     0    0.10    0.06   0   0   0   0   0
          3   0    1     0    0.09    0.04   0   0   0   0   0
          4   0    1     0    0.12    0.08   0   0   0   0   0
          5   0    1     0    0.06    0.03   0   0   0   0   0
          6   0    1     0    0.06    0.02   0   0   0   0   0
          7   0    1     0    0.20    0.10   0   0   0   0   0
          8   0    1     0    0.20    0.10   0   0   0   0   0
          9   0    1     0    0.06    0.02   0   0   0   0   0
          10  0    1     0    0.06    0.02   0   0   0   0   0
          11  0    1     0    0.045   0.03   0   0   0   0   0
          12  0    1     0    0.06    0.035  0   0   0   0   0
          13  0    1     0    0.06    0.035  0   0   0   0   0
          14  0    1     0    0.12    0.08   0   0   0   0   0
          15  0    1     0    0.06    0.01   0   0   0   0   0
          16  0    1     0    0.06    0.02   0   0   0   0   0
          17  0    1     0    0.06    0.02   0   0   0   0   0
          18  0    1     0    0.09    0.04   0   0   0   0   0
          19  0    1     0    0.09    0.04   0   0   0   0   0
          20  0    1     0    0.09    0.04   0   0   0   0   0
          21  0    1     0    0.09    0.04   0   0   0   0   0
          22  0    1     0    0.09    0.04   0   0   0   0   0
          23  0    1     0    0.09    0.05   0   0   0   0   0
          24  0    1     0    0.42    0.20   0   0   0   0   0
          25  0    1     0    0.42    0.20   0   0   0   0   0
          26  0    1     0    0.06    0.02   0   0   0   0   0
          27  0    1     0    0.06    0.025  0   0   0   0   0
          28  0    1     0    0.06    0.02   0   0   0   0   0
          29  0    1     0    0.12    0.07   0   0   0   0   0
          30  0    1     0    0.20    0.60   0   0   0   0   0
          31  0    1     0    0.15    0.07   0   0   0   0   0
          32  0    1     0    0.21    0.10   0   0   0   0   0
          33  0    1     0    0.06    0.04   0   0   0   0   0];

%        Bus   Bus     R        X       1/2B
%        No.   No.    p.u.     p.u.     p.u.
linedata=[1       2       0.0575    0.0293         0    1
          2       3       0.3076    0.1567         0    1
          3       4       0.2284    0.1163         0    1
          4       5       0.2378    0.1211         0    1
          5       6       0.5110    0.4411         0    1
          6       7       0.1168    0.3861         0    1
          7       8       0.4438    0.1467         0    1
          8       9       0.6426    0.4617         0    1
          9       10      0.6514    0.4617         0    1
          10      11      0.1227    0.0405         0    1
          11      12      0.2336    0.0810         0    1
          12      13      0.9159    0.7206         0    1
          13      14      0.3379    0.4448         0    1
          14      15      0.3687    0.3282         0    1
          15      16      0.4657    0.3400         0    1
          16      17      0.8042    1.0738         0    1
          17      18      0.4567    0.3581         0    1
          2       19      0.1023    0.0976         0    1
          19      20      0.9385    0.8457         0    1
          20      21      0.2555    0.2985         0    1
          21      22      0.4423    0.5848         0    1
          3       23      0.2815    0.1924         0    1
          23      24      0.5602    0.4424         0    1
          24      25      0.5590    0.4374         0    1
          6       26      0.1267    0.0645         0    1
          26      27      0.1773    0.0903         0    1
          27      28      0.6607    0.5826         0    1
          28      29      0.5017    0.4371         0    1
          29      30      0.3166    0.1613         0    1
          30      31      0.6080    0.6009         0    1
          31      32      0.1937    0.2258         0    1
          32      33      0.2127    0.3308         0    1]; 
%         Gen.  Ra     Xd'
gendata=[ 1     0     0.20
          10    0     0.15
          11    0     0.25];
lfybus                              % Forms the bus admittance matrix
lfnewton               % Power flow solution by Newton-Raphson method
busout                 % Prints the power flow solution on the screen
Zbus=zbuildpi(linedata, gendata, yload);%Forms Zbus including the load
clear n
for n=1:nbus
zthev(n)=Zbus(n,n);
end
zthev'
G.Rg=real(zthev')
G.Lg=-imag(zthev')/(2*pi*50)
zbusabs=abs(zthev);
[row_max,column_max]=find(zbusabs==max(zbusabs));
G.Rg(column_max)
G.Lg(column_max)